google.charts.load('current', {packages: ['corechart', 'line']});
google.charts.setOnLoadCallback(drawBasic);


    // var groundFloor;
    // var groundFloorReqURL = 'api/groundFloorStores.json';
    // var groundFloorReq = new XMLHttpRequest();
    // groundFloorReq.open('GET', groundFloorReqURL);
    // groundFloorReq.send();
    // groundFloorReq.onload = () => {
    //     var groundFloorStores = groundFloorReq.response;
    //     var obj = JSON.parse(groundFloorStores);
    //     groundFloor = obj;
    // }

    // var firstFloor;
    // var firstFloorReqURL = 'api/firstFloorStores.json';
    // var firstFloorReq = new XMLHttpRequest();
    // firstFloorReq.open('GET', firstFloorReqURL);
    // firstFloorReq.send();
    // firstFloorReq.onload = () => {
    //     var firstFloorStores = firstFloorReq.response;
    //     var obj = JSON.parse(firstFloorStores);
    //     firstFloor = obj;
    // }

    // var storeData;
    // var storeReqURL = 'api/data.json';
    // var storeReq = new XMLHttpRequest();
    // storeReq.open('GET', storeReqURL);
    // storeReq.send();
    // storeReq.onload = () => {
    //     var storeDatas = storeReq.response;
    //     var obj = JSON.parse(storeDatas);
    //     storeData = obj;
    // }

function drawBasic(id) {

    var store;

    for( var i = 0; i < groundFloor.stores.length; i++)
    {
        if (storeData[i]['id'] == id)
        {
            store = i;
            break;
        }
    }
    for( var i = 0; i < firstFloor.stores.length; i++)
    {
        if (storeData[i]['id'] == id)
        {
            store = i;
            break;
        }
    }

    var data = new google.visualization.DataTable();

    data.addColumn('string', 'Time');
    data.addColumn('number', 'Occupancy');
    data.addColumn('number', 'Noise');
    data.addColumn('number', 'Humidity');


    for( var i = 1; i < 41; i++)
    {

      var timeslot = storeData[store]['history'][0]['times'][i-1]['timeslot'].toString();
      var timeslotArray = timeslot.split('');
      
      var hour = timeslotArray[11].concat(timeslotArray[12]);
      var min = timeslotArray[14].concat(timeslotArray[15]);
      var time = hour.concat(min);




      data.addRows([
          [
              
              time, 
              storeData[store]['history'][0]['times'][i-1]['occupancy']*100, 
              storeData[store]['history'][0]['times'][i-1]['noise']*100,
              storeData[store]['history'][0]['times'][i-1]['humidity']*100
          ]
      ]
      );

    }


      var options = {
        hAxis: { 
          showTextEvery : '4',
          gridlines :{count: '10'}
        },
        vAxis: {
          baseline: 0
        },
        curveType: 'function',
        width: '700',
        legend: { position: 'bottom' }
      };

    var chart_div = document.getElementById('chart_div');
    var chart = new google.visualization.LineChart(chart_div);

    // Wait for the chart to finish drawing before calling the getImageURI() method.
    google.visualization.events.addListener(chart, 'ready', function () { });

    chart.draw(data, options);
    return('<img src="' + chart.getImageURI() + '">');
}

    var groundFloor;
    var groundFloorReqURL = 'api/groundFloorStores.json';
    var groundFloorReq = new XMLHttpRequest();
    groundFloorReq.open('GET', groundFloorReqURL);
    groundFloorReq.send();
    groundFloorReq.onload = () => {
        var groundFloorStores = groundFloorReq.response;
        var obj = JSON.parse(groundFloorStores);
        groundFloor = obj;
    }

    var firstFloor;
    var firstFloorReqURL = 'api/firstFloorStores.json';
    var firstFloorReq = new XMLHttpRequest();
    firstFloorReq.open('GET', firstFloorReqURL);
    firstFloorReq.send();
    firstFloorReq.onload = () => {
        var firstFloorStores = firstFloorReq.response;
        var obj = JSON.parse(firstFloorStores);
        firstFloor = obj;
    }

    var storeData;
    var storeReqURL = 'api/data.json';
    var storeReq = new XMLHttpRequest();
    storeReq.open('GET', storeReqURL);
    storeReq.send();
    storeReq.onload = () => {
        var storeDatas = storeReq.response;
        var obj = JSON.parse(storeDatas);
        storeData = obj;
    }

// function setEntityHighlights() {
//     for(var i = 0; i < groundFloor.stores.length; i++){
//         map.indoors.setEntityHighlights(groundFloor.stores[i].id.toString(), randomColor());
//     }
//     for(var i = 0; i < firstFloor.stores.length; i++){
//         map.indoors.setEntityHighlights(firstFloor.stores[i].id.toString(), randomColor());
//     }

// }
function setStoreHighlights(store, colour){
    store = store.toString();
    map.indoors.setEntityHighlights(store, colour);
}

function randomColor(){
    var red = Math.floor(Math.random() * 256);
    var green = 255 - red;
    return [red, green, 0, 200];
}

function clearEntityHighlights(){
    map.indoors.clearEntityHighlights();
}
var map = L.Wrld.map("map", "9d876646f7d83cc709edbe204c81d546", {
    center: [56.4598, -2.9728],
    zoom: 17,
    indoorsEnabled: true
});
  var indoorControl = new WrldIndoorControl("widget-container", map);
  var currentIndoorMapId;
  var currentFloor;
  var entityIdsToPosition = {};
  
  var lastMouseDown;
  function onMouseDown(event) {
    lastMouseDown = event.latlng;
  }
  
  function onIndoorEntityClicked(event) {
    event.ids.forEach(identifyEntity);
  }

  function exportIdMap() {
    console.log(JSON.stringify(entityIdsToPosition));
  }
  
  function onIndoorMapEntered(event) {
    currentIndoorMapId = event.indoorMap.getIndoorMapId();
    currentFloor = map.indoors.getFloor().getFloorIndex();
  }
  
  function onIndoorMapFloorChanged() {
    currentFloor = map.indoors.getFloor().getFloorIndex();
  }
  
  function identifyEntity(id) {
    var latLng = lastMouseDown;

    var graph = drawBasic(id);
    
    var popupOptions = { 
      indoorMapId: currentIndoorMapId, 
      indoorMapFloorIndex: currentFloor, 
      autoClose: false, 
      closeOnClick: false,
      minWidth: "5"          
    };
    var popup = L.popup(popupOptions)
      .setLatLng(latLng)
      .addTo(map)
      .setContent(graph);
    entityIdsToPosition[id] = { "latLng": latLng, "indoorId": currentIndoorMapId, "floorIndex": currentFloor } ;
  }

  map.indoors.on("indoormapenter", onIndoorMapEntered);
  map.indoors.on("indoormapfloorchange", onIndoorMapFloorChanged)
  map.indoors.on("indoorentityclick", onIndoorEntityClicked);
  map.on("mousedown", onMouseDown);
// var d = new Date();
// document.getElementById("date").innerHTML = d;
//Onload function to setup sliders
window.onload = function (){
    var sliders = document.getElementsByClassName("rangePicker");
    // var textBoxes = document.getElementsByClassName("textBox");
    [].forEach.call(sliders, function (slider) {    
        slider.min = 10;
        slider.max = 50;
        slider.step = 10;
        slider.value = 30;
    });

    document.getElementById("SAD").addEventListener("click", presetsUpdate(0));
    document.getElementById("GOOD").addEventListener("click", presetsUpdate(2));
    document.getElementById("NORMAL").addEventListener("click", presetsUpdate(1));
}

function presetsUpdate(level){
    var occupancy = [10,30,50];
    var noise = [10,30,50];
    var humidity = [10,30,50];

    for(var i=0; i < 3; i++){
        document.getElementById("occupancy-slider").value = occupancy[level];
        document.getElementById("noise-slider").value = noise[level];
        document.getElementById("humidity-slider").value = humidity[level];
    }
}
// Called when a slider is updated. 
function updateMapFromSliders(){ 

    var stores = storeData;
    var current = getCurrentSliderLevel();
    var level = Math.round(getAverageSliderLevel(current));
    var max = getMaxToleranceLevel(level);
    var min = getMinToleranceLevel(level);

    for(var i = 0; i < stores.length; i++){
        var storeID = stores[i].id;
        //var currentData = getCurrentData(storeID, Math.round(level));
        var dataArray = getCurrentTimeslot(storeID);
        console.log(dataArray, i);
        var colour = calculateColour(dataArray, max, min); 

        setStoreHighlights(storeID, colour);
    }

}

// Gets current levels sliders are at, parses them into numbers.
// Returns as an array.
function getCurrentSliderLevel(){
    var sliderArray =[];
    var sliders = document.getElementsByClassName("rangePicker");
    [].forEach.call(sliders, function (slider) {
        sliderArray.push(parseInt(slider.value, 10));
    });
    return sliderArray;
}


// Takes an array of numbers (int)
// Returns the average of the array.
// Code for avaraging arrays found via Google at https://gist.github.com/bmorelli25/4564b8ff35b47d8a9db6b0dda1143465
function getAverageSliderLevel(sliderArray){
    const arrAvg = arr => arr.reduce((a,b) => a + b, 0) / arr.length;
    return arrAvg(sliderArray);
};

function getMaxToleranceLevel(sliderAvg){
    var maxTolerable;
    switch(sliderAvg){
        case 1:
        case 2:
            return maxTolerable = 0.4;
            break;
        case 3:
            return maxTolerable = 0.6;
            break;
        case 4:
        case 5:
            return maxTolerable = 0.9;
            break;
    }
}
function getMinToleranceLevel(sliderAvg){
    var minTolerable;

    switch(sliderAvg){
        case 1:
        case 2:
            return minTolerable = 0.1;
            break;
        case 3:
            return minTolerable = 0.3;
            break;
        case 4:
        case 5:
            return minTolerable = 0.6;
            break;
    }
}
// parseDataObj(obj);
//     obj
//     currentDataArray = [];
//     currentArray.push(currentTimeslot['occupancy']);
//     currentArray.push(currentTimeslot['noise']);
//     currentArray.push(currentTimeslot['humidity']);

//     return calculateColour(currentArray, maxTolerable, minTolerable);
// }

function getCurrentTimeslot(id){
    var store;
    for( var i = 0; i < groundFloor.stores.length; i++) {
        if (storeData[i]['id'] == id) {
            store = i;
            break;
        }
    }
    return storeData[store]['history'][0]['times'][0];
}

function checkValue(value, max, min){
    var colourLevel = 0;
    if(parseFloat(value) > max){ colourLevel = 5; };
    if(parseFloat(value) < min){ colourLevel = 1; };
    if(parseFloat(value) < max && parseFloat(value > min)){ colourLevel = 3; };
    return parseInt(colourLevel);
}

function calculateColour(currentDataObj, max, min){
    var colourLevel = 0;
    var colour;
    var occupancy = currentDataObj.occupancy;
    var noise = currentDataObj.noise;
    var humidity = currentDataObj.humidity;

    colourLevel += checkValue(occupancy,max,min);
    colourLevel += checkValue(noise, max, min);
    colourLevel += checkValue(humidity, max, min);
    
    var avgColourLevel = Math.round(colourLevel / 3);
    console.log(avgColourLevel);
    switch(avgColourLevel){
        case 1:
        case 2:
            colour = [255,0,0,200];
            break;
        case 3:
            colour = [255,140,0,200];
            break;
        case 4:
        case 5:
            colour = [0,255,0,200];
            break;
    }
    return colour;
}

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImdyYXBoLmpzIiwibG9hZERhdGEuanMiLCJtYXBIaWdobGlnaHRpbmcuanMiLCJwb3B1cHMuanMiLCJyZWFsVGltZUdyYXBoLmpzIiwic2V0dGluZ3MuanMiLCJzbGlkZXJzLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNuSEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDaENBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN0QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN0REE7QUFDQTtBQ0RBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzFCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJmaWxlIjoiYXBwLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbImdvb2dsZS5jaGFydHMubG9hZCgnY3VycmVudCcsIHtwYWNrYWdlczogWydjb3JlY2hhcnQnLCAnbGluZSddfSk7XG5nb29nbGUuY2hhcnRzLnNldE9uTG9hZENhbGxiYWNrKGRyYXdCYXNpYyk7XG5cblxuICAgIC8vIHZhciBncm91bmRGbG9vcjtcbiAgICAvLyB2YXIgZ3JvdW5kRmxvb3JSZXFVUkwgPSAnYXBpL2dyb3VuZEZsb29yU3RvcmVzLmpzb24nO1xuICAgIC8vIHZhciBncm91bmRGbG9vclJlcSA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpO1xuICAgIC8vIGdyb3VuZEZsb29yUmVxLm9wZW4oJ0dFVCcsIGdyb3VuZEZsb29yUmVxVVJMKTtcbiAgICAvLyBncm91bmRGbG9vclJlcS5zZW5kKCk7XG4gICAgLy8gZ3JvdW5kRmxvb3JSZXEub25sb2FkID0gKCkgPT4ge1xuICAgIC8vICAgICB2YXIgZ3JvdW5kRmxvb3JTdG9yZXMgPSBncm91bmRGbG9vclJlcS5yZXNwb25zZTtcbiAgICAvLyAgICAgdmFyIG9iaiA9IEpTT04ucGFyc2UoZ3JvdW5kRmxvb3JTdG9yZXMpO1xuICAgIC8vICAgICBncm91bmRGbG9vciA9IG9iajtcbiAgICAvLyB9XG5cbiAgICAvLyB2YXIgZmlyc3RGbG9vcjtcbiAgICAvLyB2YXIgZmlyc3RGbG9vclJlcVVSTCA9ICdhcGkvZmlyc3RGbG9vclN0b3Jlcy5qc29uJztcbiAgICAvLyB2YXIgZmlyc3RGbG9vclJlcSA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpO1xuICAgIC8vIGZpcnN0Rmxvb3JSZXEub3BlbignR0VUJywgZmlyc3RGbG9vclJlcVVSTCk7XG4gICAgLy8gZmlyc3RGbG9vclJlcS5zZW5kKCk7XG4gICAgLy8gZmlyc3RGbG9vclJlcS5vbmxvYWQgPSAoKSA9PiB7XG4gICAgLy8gICAgIHZhciBmaXJzdEZsb29yU3RvcmVzID0gZmlyc3RGbG9vclJlcS5yZXNwb25zZTtcbiAgICAvLyAgICAgdmFyIG9iaiA9IEpTT04ucGFyc2UoZmlyc3RGbG9vclN0b3Jlcyk7XG4gICAgLy8gICAgIGZpcnN0Rmxvb3IgPSBvYmo7XG4gICAgLy8gfVxuXG4gICAgLy8gdmFyIHN0b3JlRGF0YTtcbiAgICAvLyB2YXIgc3RvcmVSZXFVUkwgPSAnYXBpL2RhdGEuanNvbic7XG4gICAgLy8gdmFyIHN0b3JlUmVxID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7XG4gICAgLy8gc3RvcmVSZXEub3BlbignR0VUJywgc3RvcmVSZXFVUkwpO1xuICAgIC8vIHN0b3JlUmVxLnNlbmQoKTtcbiAgICAvLyBzdG9yZVJlcS5vbmxvYWQgPSAoKSA9PiB7XG4gICAgLy8gICAgIHZhciBzdG9yZURhdGFzID0gc3RvcmVSZXEucmVzcG9uc2U7XG4gICAgLy8gICAgIHZhciBvYmogPSBKU09OLnBhcnNlKHN0b3JlRGF0YXMpO1xuICAgIC8vICAgICBzdG9yZURhdGEgPSBvYmo7XG4gICAgLy8gfVxuXG5mdW5jdGlvbiBkcmF3QmFzaWMoaWQpIHtcblxuICAgIHZhciBzdG9yZTtcblxuICAgIGZvciggdmFyIGkgPSAwOyBpIDwgZ3JvdW5kRmxvb3Iuc3RvcmVzLmxlbmd0aDsgaSsrKVxuICAgIHtcbiAgICAgICAgaWYgKHN0b3JlRGF0YVtpXVsnaWQnXSA9PSBpZClcbiAgICAgICAge1xuICAgICAgICAgICAgc3RvcmUgPSBpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZm9yKCB2YXIgaSA9IDA7IGkgPCBmaXJzdEZsb29yLnN0b3Jlcy5sZW5ndGg7IGkrKylcbiAgICB7XG4gICAgICAgIGlmIChzdG9yZURhdGFbaV1bJ2lkJ10gPT0gaWQpXG4gICAgICAgIHtcbiAgICAgICAgICAgIHN0b3JlID0gaTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgdmFyIGRhdGEgPSBuZXcgZ29vZ2xlLnZpc3VhbGl6YXRpb24uRGF0YVRhYmxlKCk7XG5cbiAgICBkYXRhLmFkZENvbHVtbignc3RyaW5nJywgJ1RpbWUnKTtcbiAgICBkYXRhLmFkZENvbHVtbignbnVtYmVyJywgJ09jY3VwYW5jeScpO1xuICAgIGRhdGEuYWRkQ29sdW1uKCdudW1iZXInLCAnTm9pc2UnKTtcbiAgICBkYXRhLmFkZENvbHVtbignbnVtYmVyJywgJ0h1bWlkaXR5Jyk7XG5cblxuICAgIGZvciggdmFyIGkgPSAxOyBpIDwgNDE7IGkrKylcbiAgICB7XG5cbiAgICAgIHZhciB0aW1lc2xvdCA9IHN0b3JlRGF0YVtzdG9yZV1bJ2hpc3RvcnknXVswXVsndGltZXMnXVtpLTFdWyd0aW1lc2xvdCddLnRvU3RyaW5nKCk7XG4gICAgICB2YXIgdGltZXNsb3RBcnJheSA9IHRpbWVzbG90LnNwbGl0KCcnKTtcbiAgICAgIFxuICAgICAgdmFyIGhvdXIgPSB0aW1lc2xvdEFycmF5WzExXS5jb25jYXQodGltZXNsb3RBcnJheVsxMl0pO1xuICAgICAgdmFyIG1pbiA9IHRpbWVzbG90QXJyYXlbMTRdLmNvbmNhdCh0aW1lc2xvdEFycmF5WzE1XSk7XG4gICAgICB2YXIgdGltZSA9IGhvdXIuY29uY2F0KG1pbik7XG5cblxuXG5cbiAgICAgIGRhdGEuYWRkUm93cyhbXG4gICAgICAgICAgW1xuICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgdGltZSwgXG4gICAgICAgICAgICAgIHN0b3JlRGF0YVtzdG9yZV1bJ2hpc3RvcnknXVswXVsndGltZXMnXVtpLTFdWydvY2N1cGFuY3knXSoxMDAsIFxuICAgICAgICAgICAgICBzdG9yZURhdGFbc3RvcmVdWydoaXN0b3J5J11bMF1bJ3RpbWVzJ11baS0xXVsnbm9pc2UnXSoxMDAsXG4gICAgICAgICAgICAgIHN0b3JlRGF0YVtzdG9yZV1bJ2hpc3RvcnknXVswXVsndGltZXMnXVtpLTFdWydodW1pZGl0eSddKjEwMFxuICAgICAgICAgIF1cbiAgICAgIF1cbiAgICAgICk7XG5cbiAgICB9XG5cblxuICAgICAgdmFyIG9wdGlvbnMgPSB7XG4gICAgICAgIGhBeGlzOiB7IFxuICAgICAgICAgIHNob3dUZXh0RXZlcnkgOiAnNCcsXG4gICAgICAgICAgZ3JpZGxpbmVzIDp7Y291bnQ6ICcxMCd9XG4gICAgICAgIH0sXG4gICAgICAgIHZBeGlzOiB7XG4gICAgICAgICAgYmFzZWxpbmU6IDBcbiAgICAgICAgfSxcbiAgICAgICAgY3VydmVUeXBlOiAnZnVuY3Rpb24nLFxuICAgICAgICB3aWR0aDogJzcwMCcsXG4gICAgICAgIGxlZ2VuZDogeyBwb3NpdGlvbjogJ2JvdHRvbScgfVxuICAgICAgfTtcblxuICAgIHZhciBjaGFydF9kaXYgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2hhcnRfZGl2Jyk7XG4gICAgdmFyIGNoYXJ0ID0gbmV3IGdvb2dsZS52aXN1YWxpemF0aW9uLkxpbmVDaGFydChjaGFydF9kaXYpO1xuXG4gICAgLy8gV2FpdCBmb3IgdGhlIGNoYXJ0IHRvIGZpbmlzaCBkcmF3aW5nIGJlZm9yZSBjYWxsaW5nIHRoZSBnZXRJbWFnZVVSSSgpIG1ldGhvZC5cbiAgICBnb29nbGUudmlzdWFsaXphdGlvbi5ldmVudHMuYWRkTGlzdGVuZXIoY2hhcnQsICdyZWFkeScsIGZ1bmN0aW9uICgpIHsgfSk7XG5cbiAgICBjaGFydC5kcmF3KGRhdGEsIG9wdGlvbnMpO1xuICAgIHJldHVybignPGltZyBzcmM9XCInICsgY2hhcnQuZ2V0SW1hZ2VVUkkoKSArICdcIj4nKTtcbn1cbiIsIiAgICB2YXIgZ3JvdW5kRmxvb3I7XG4gICAgdmFyIGdyb3VuZEZsb29yUmVxVVJMID0gJ2FwaS9ncm91bmRGbG9vclN0b3Jlcy5qc29uJztcbiAgICB2YXIgZ3JvdW5kRmxvb3JSZXEgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTtcbiAgICBncm91bmRGbG9vclJlcS5vcGVuKCdHRVQnLCBncm91bmRGbG9vclJlcVVSTCk7XG4gICAgZ3JvdW5kRmxvb3JSZXEuc2VuZCgpO1xuICAgIGdyb3VuZEZsb29yUmVxLm9ubG9hZCA9ICgpID0+IHtcbiAgICAgICAgdmFyIGdyb3VuZEZsb29yU3RvcmVzID0gZ3JvdW5kRmxvb3JSZXEucmVzcG9uc2U7XG4gICAgICAgIHZhciBvYmogPSBKU09OLnBhcnNlKGdyb3VuZEZsb29yU3RvcmVzKTtcbiAgICAgICAgZ3JvdW5kRmxvb3IgPSBvYmo7XG4gICAgfVxuXG4gICAgdmFyIGZpcnN0Rmxvb3I7XG4gICAgdmFyIGZpcnN0Rmxvb3JSZXFVUkwgPSAnYXBpL2ZpcnN0Rmxvb3JTdG9yZXMuanNvbic7XG4gICAgdmFyIGZpcnN0Rmxvb3JSZXEgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTtcbiAgICBmaXJzdEZsb29yUmVxLm9wZW4oJ0dFVCcsIGZpcnN0Rmxvb3JSZXFVUkwpO1xuICAgIGZpcnN0Rmxvb3JSZXEuc2VuZCgpO1xuICAgIGZpcnN0Rmxvb3JSZXEub25sb2FkID0gKCkgPT4ge1xuICAgICAgICB2YXIgZmlyc3RGbG9vclN0b3JlcyA9IGZpcnN0Rmxvb3JSZXEucmVzcG9uc2U7XG4gICAgICAgIHZhciBvYmogPSBKU09OLnBhcnNlKGZpcnN0Rmxvb3JTdG9yZXMpO1xuICAgICAgICBmaXJzdEZsb29yID0gb2JqO1xuICAgIH1cblxuICAgIHZhciBzdG9yZURhdGE7XG4gICAgdmFyIHN0b3JlUmVxVVJMID0gJ2FwaS9kYXRhLmpzb24nO1xuICAgIHZhciBzdG9yZVJlcSA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpO1xuICAgIHN0b3JlUmVxLm9wZW4oJ0dFVCcsIHN0b3JlUmVxVVJMKTtcbiAgICBzdG9yZVJlcS5zZW5kKCk7XG4gICAgc3RvcmVSZXEub25sb2FkID0gKCkgPT4ge1xuICAgICAgICB2YXIgc3RvcmVEYXRhcyA9IHN0b3JlUmVxLnJlc3BvbnNlO1xuICAgICAgICB2YXIgb2JqID0gSlNPTi5wYXJzZShzdG9yZURhdGFzKTtcbiAgICAgICAgc3RvcmVEYXRhID0gb2JqO1xuICAgIH1cbiIsIi8vIGZ1bmN0aW9uIHNldEVudGl0eUhpZ2hsaWdodHMoKSB7XG4vLyAgICAgZm9yKHZhciBpID0gMDsgaSA8IGdyb3VuZEZsb29yLnN0b3Jlcy5sZW5ndGg7IGkrKyl7XG4vLyAgICAgICAgIG1hcC5pbmRvb3JzLnNldEVudGl0eUhpZ2hsaWdodHMoZ3JvdW5kRmxvb3Iuc3RvcmVzW2ldLmlkLnRvU3RyaW5nKCksIHJhbmRvbUNvbG9yKCkpO1xuLy8gICAgIH1cbi8vICAgICBmb3IodmFyIGkgPSAwOyBpIDwgZmlyc3RGbG9vci5zdG9yZXMubGVuZ3RoOyBpKyspe1xuLy8gICAgICAgICBtYXAuaW5kb29ycy5zZXRFbnRpdHlIaWdobGlnaHRzKGZpcnN0Rmxvb3Iuc3RvcmVzW2ldLmlkLnRvU3RyaW5nKCksIHJhbmRvbUNvbG9yKCkpO1xuLy8gICAgIH1cblxuLy8gfVxuZnVuY3Rpb24gc2V0U3RvcmVIaWdobGlnaHRzKHN0b3JlLCBjb2xvdXIpe1xuICAgIHN0b3JlID0gc3RvcmUudG9TdHJpbmcoKTtcbiAgICBtYXAuaW5kb29ycy5zZXRFbnRpdHlIaWdobGlnaHRzKHN0b3JlLCBjb2xvdXIpO1xufVxuXG5mdW5jdGlvbiByYW5kb21Db2xvcigpe1xuICAgIHZhciByZWQgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAyNTYpO1xuICAgIHZhciBncmVlbiA9IDI1NSAtIHJlZDtcbiAgICByZXR1cm4gW3JlZCwgZ3JlZW4sIDAsIDIwMF07XG59XG5cbmZ1bmN0aW9uIGNsZWFyRW50aXR5SGlnaGxpZ2h0cygpe1xuICAgIG1hcC5pbmRvb3JzLmNsZWFyRW50aXR5SGlnaGxpZ2h0cygpO1xufSIsInZhciBtYXAgPSBMLldybGQubWFwKFwibWFwXCIsIFwiOWQ4NzY2NDZmN2Q4M2NjNzA5ZWRiZTIwNGM4MWQ1NDZcIiwge1xuICAgIGNlbnRlcjogWzU2LjQ1OTgsIC0yLjk3MjhdLFxuICAgIHpvb206IDE3LFxuICAgIGluZG9vcnNFbmFibGVkOiB0cnVlXG59KTtcbiAgdmFyIGluZG9vckNvbnRyb2wgPSBuZXcgV3JsZEluZG9vckNvbnRyb2woXCJ3aWRnZXQtY29udGFpbmVyXCIsIG1hcCk7XG4gIHZhciBjdXJyZW50SW5kb29yTWFwSWQ7XG4gIHZhciBjdXJyZW50Rmxvb3I7XG4gIHZhciBlbnRpdHlJZHNUb1Bvc2l0aW9uID0ge307XG4gIFxuICB2YXIgbGFzdE1vdXNlRG93bjtcbiAgZnVuY3Rpb24gb25Nb3VzZURvd24oZXZlbnQpIHtcbiAgICBsYXN0TW91c2VEb3duID0gZXZlbnQubGF0bG5nO1xuICB9XG4gIFxuICBmdW5jdGlvbiBvbkluZG9vckVudGl0eUNsaWNrZWQoZXZlbnQpIHtcbiAgICBldmVudC5pZHMuZm9yRWFjaChpZGVudGlmeUVudGl0eSk7XG4gIH1cblxuICBmdW5jdGlvbiBleHBvcnRJZE1hcCgpIHtcbiAgICBjb25zb2xlLmxvZyhKU09OLnN0cmluZ2lmeShlbnRpdHlJZHNUb1Bvc2l0aW9uKSk7XG4gIH1cbiAgXG4gIGZ1bmN0aW9uIG9uSW5kb29yTWFwRW50ZXJlZChldmVudCkge1xuICAgIGN1cnJlbnRJbmRvb3JNYXBJZCA9IGV2ZW50LmluZG9vck1hcC5nZXRJbmRvb3JNYXBJZCgpO1xuICAgIGN1cnJlbnRGbG9vciA9IG1hcC5pbmRvb3JzLmdldEZsb29yKCkuZ2V0Rmxvb3JJbmRleCgpO1xuICB9XG4gIFxuICBmdW5jdGlvbiBvbkluZG9vck1hcEZsb29yQ2hhbmdlZCgpIHtcbiAgICBjdXJyZW50Rmxvb3IgPSBtYXAuaW5kb29ycy5nZXRGbG9vcigpLmdldEZsb29ySW5kZXgoKTtcbiAgfVxuICBcbiAgZnVuY3Rpb24gaWRlbnRpZnlFbnRpdHkoaWQpIHtcbiAgICB2YXIgbGF0TG5nID0gbGFzdE1vdXNlRG93bjtcblxuICAgIHZhciBncmFwaCA9IGRyYXdCYXNpYyhpZCk7XG4gICAgXG4gICAgdmFyIHBvcHVwT3B0aW9ucyA9IHsgXG4gICAgICBpbmRvb3JNYXBJZDogY3VycmVudEluZG9vck1hcElkLCBcbiAgICAgIGluZG9vck1hcEZsb29ySW5kZXg6IGN1cnJlbnRGbG9vciwgXG4gICAgICBhdXRvQ2xvc2U6IGZhbHNlLCBcbiAgICAgIGNsb3NlT25DbGljazogZmFsc2UsXG4gICAgICBtaW5XaWR0aDogXCI1XCIgICAgICAgICAgXG4gICAgfTtcbiAgICB2YXIgcG9wdXAgPSBMLnBvcHVwKHBvcHVwT3B0aW9ucylcbiAgICAgIC5zZXRMYXRMbmcobGF0TG5nKVxuICAgICAgLmFkZFRvKG1hcClcbiAgICAgIC5zZXRDb250ZW50KGdyYXBoKTtcbiAgICBlbnRpdHlJZHNUb1Bvc2l0aW9uW2lkXSA9IHsgXCJsYXRMbmdcIjogbGF0TG5nLCBcImluZG9vcklkXCI6IGN1cnJlbnRJbmRvb3JNYXBJZCwgXCJmbG9vckluZGV4XCI6IGN1cnJlbnRGbG9vciB9IDtcbiAgfVxuXG4gIG1hcC5pbmRvb3JzLm9uKFwiaW5kb29ybWFwZW50ZXJcIiwgb25JbmRvb3JNYXBFbnRlcmVkKTtcbiAgbWFwLmluZG9vcnMub24oXCJpbmRvb3JtYXBmbG9vcmNoYW5nZVwiLCBvbkluZG9vck1hcEZsb29yQ2hhbmdlZClcbiAgbWFwLmluZG9vcnMub24oXCJpbmRvb3JlbnRpdHljbGlja1wiLCBvbkluZG9vckVudGl0eUNsaWNrZWQpO1xuICBtYXAub24oXCJtb3VzZWRvd25cIiwgb25Nb3VzZURvd24pOyIsIi8vIHZhciBkID0gbmV3IERhdGUoKTtcbi8vIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiZGF0ZVwiKS5pbm5lckhUTUwgPSBkOyIsIi8vT25sb2FkIGZ1bmN0aW9uIHRvIHNldHVwIHNsaWRlcnNcbndpbmRvdy5vbmxvYWQgPSBmdW5jdGlvbiAoKXtcbiAgICB2YXIgc2xpZGVycyA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoXCJyYW5nZVBpY2tlclwiKTtcbiAgICAvLyB2YXIgdGV4dEJveGVzID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZShcInRleHRCb3hcIik7XG4gICAgW10uZm9yRWFjaC5jYWxsKHNsaWRlcnMsIGZ1bmN0aW9uIChzbGlkZXIpIHsgICAgXG4gICAgICAgIHNsaWRlci5taW4gPSAxMDtcbiAgICAgICAgc2xpZGVyLm1heCA9IDUwO1xuICAgICAgICBzbGlkZXIuc3RlcCA9IDEwO1xuICAgICAgICBzbGlkZXIudmFsdWUgPSAzMDtcbiAgICB9KTtcblxuICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiU0FEXCIpLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBwcmVzZXRzVXBkYXRlKDApKTtcbiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcIkdPT0RcIikuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIHByZXNldHNVcGRhdGUoMikpO1xuICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiTk9STUFMXCIpLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBwcmVzZXRzVXBkYXRlKDEpKTtcbn1cblxuZnVuY3Rpb24gcHJlc2V0c1VwZGF0ZShsZXZlbCl7XG4gICAgdmFyIG9jY3VwYW5jeSA9IFsxMCwzMCw1MF07XG4gICAgdmFyIG5vaXNlID0gWzEwLDMwLDUwXTtcbiAgICB2YXIgaHVtaWRpdHkgPSBbMTAsMzAsNTBdO1xuXG4gICAgZm9yKHZhciBpPTA7IGkgPCAzOyBpKyspe1xuICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcIm9jY3VwYW5jeS1zbGlkZXJcIikudmFsdWUgPSBvY2N1cGFuY3lbbGV2ZWxdO1xuICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcIm5vaXNlLXNsaWRlclwiKS52YWx1ZSA9IG5vaXNlW2xldmVsXTtcbiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJodW1pZGl0eS1zbGlkZXJcIikudmFsdWUgPSBodW1pZGl0eVtsZXZlbF07XG4gICAgfVxufSIsIi8vIENhbGxlZCB3aGVuIGEgc2xpZGVyIGlzIHVwZGF0ZWQuIFxuZnVuY3Rpb24gdXBkYXRlTWFwRnJvbVNsaWRlcnMoKXsgXG5cbiAgICB2YXIgc3RvcmVzID0gc3RvcmVEYXRhO1xuICAgIHZhciBjdXJyZW50ID0gZ2V0Q3VycmVudFNsaWRlckxldmVsKCk7XG4gICAgdmFyIGxldmVsID0gTWF0aC5yb3VuZChnZXRBdmVyYWdlU2xpZGVyTGV2ZWwoY3VycmVudCkpO1xuICAgIHZhciBtYXggPSBnZXRNYXhUb2xlcmFuY2VMZXZlbChsZXZlbCk7XG4gICAgdmFyIG1pbiA9IGdldE1pblRvbGVyYW5jZUxldmVsKGxldmVsKTtcblxuICAgIGZvcih2YXIgaSA9IDA7IGkgPCBzdG9yZXMubGVuZ3RoOyBpKyspe1xuICAgICAgICB2YXIgc3RvcmVJRCA9IHN0b3Jlc1tpXS5pZDtcbiAgICAgICAgLy92YXIgY3VycmVudERhdGEgPSBnZXRDdXJyZW50RGF0YShzdG9yZUlELCBNYXRoLnJvdW5kKGxldmVsKSk7XG4gICAgICAgIHZhciBkYXRhQXJyYXkgPSBnZXRDdXJyZW50VGltZXNsb3Qoc3RvcmVJRCk7XG4gICAgICAgIGNvbnNvbGUubG9nKGRhdGFBcnJheSwgaSk7XG4gICAgICAgIHZhciBjb2xvdXIgPSBjYWxjdWxhdGVDb2xvdXIoZGF0YUFycmF5LCBtYXgsIG1pbik7IFxuXG4gICAgICAgIHNldFN0b3JlSGlnaGxpZ2h0cyhzdG9yZUlELCBjb2xvdXIpO1xuICAgIH1cblxufVxuXG4vLyBHZXRzIGN1cnJlbnQgbGV2ZWxzIHNsaWRlcnMgYXJlIGF0LCBwYXJzZXMgdGhlbSBpbnRvIG51bWJlcnMuXG4vLyBSZXR1cm5zIGFzIGFuIGFycmF5LlxuZnVuY3Rpb24gZ2V0Q3VycmVudFNsaWRlckxldmVsKCl7XG4gICAgdmFyIHNsaWRlckFycmF5ID1bXTtcbiAgICB2YXIgc2xpZGVycyA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoXCJyYW5nZVBpY2tlclwiKTtcbiAgICBbXS5mb3JFYWNoLmNhbGwoc2xpZGVycywgZnVuY3Rpb24gKHNsaWRlcikge1xuICAgICAgICBzbGlkZXJBcnJheS5wdXNoKHBhcnNlSW50KHNsaWRlci52YWx1ZSwgMTApKTtcbiAgICB9KTtcbiAgICByZXR1cm4gc2xpZGVyQXJyYXk7XG59XG5cblxuLy8gVGFrZXMgYW4gYXJyYXkgb2YgbnVtYmVycyAoaW50KVxuLy8gUmV0dXJucyB0aGUgYXZlcmFnZSBvZiB0aGUgYXJyYXkuXG4vLyBDb2RlIGZvciBhdmFyYWdpbmcgYXJyYXlzIGZvdW5kIHZpYSBHb29nbGUgYXQgaHR0cHM6Ly9naXN0LmdpdGh1Yi5jb20vYm1vcmVsbGkyNS80NTY0YjhmZjM1YjQ3ZDhhOWRiNmIwZGRhMTE0MzQ2NVxuZnVuY3Rpb24gZ2V0QXZlcmFnZVNsaWRlckxldmVsKHNsaWRlckFycmF5KXtcbiAgICBjb25zdCBhcnJBdmcgPSBhcnIgPT4gYXJyLnJlZHVjZSgoYSxiKSA9PiBhICsgYiwgMCkgLyBhcnIubGVuZ3RoO1xuICAgIHJldHVybiBhcnJBdmcoc2xpZGVyQXJyYXkpO1xufTtcblxuZnVuY3Rpb24gZ2V0TWF4VG9sZXJhbmNlTGV2ZWwoc2xpZGVyQXZnKXtcbiAgICB2YXIgbWF4VG9sZXJhYmxlO1xuICAgIHN3aXRjaChzbGlkZXJBdmcpe1xuICAgICAgICBjYXNlIDE6XG4gICAgICAgIGNhc2UgMjpcbiAgICAgICAgICAgIHJldHVybiBtYXhUb2xlcmFibGUgPSAwLjQ7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAzOlxuICAgICAgICAgICAgcmV0dXJuIG1heFRvbGVyYWJsZSA9IDAuNjtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIDQ6XG4gICAgICAgIGNhc2UgNTpcbiAgICAgICAgICAgIHJldHVybiBtYXhUb2xlcmFibGUgPSAwLjk7XG4gICAgICAgICAgICBicmVhaztcbiAgICB9XG59XG5mdW5jdGlvbiBnZXRNaW5Ub2xlcmFuY2VMZXZlbChzbGlkZXJBdmcpe1xuICAgIHZhciBtaW5Ub2xlcmFibGU7XG5cbiAgICBzd2l0Y2goc2xpZGVyQXZnKXtcbiAgICAgICAgY2FzZSAxOlxuICAgICAgICBjYXNlIDI6XG4gICAgICAgICAgICByZXR1cm4gbWluVG9sZXJhYmxlID0gMC4xO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgMzpcbiAgICAgICAgICAgIHJldHVybiBtaW5Ub2xlcmFibGUgPSAwLjM7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSA0OlxuICAgICAgICBjYXNlIDU6XG4gICAgICAgICAgICByZXR1cm4gbWluVG9sZXJhYmxlID0gMC42O1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgfVxufVxuLy8gcGFyc2VEYXRhT2JqKG9iaik7XG4vLyAgICAgb2JqXG4vLyAgICAgY3VycmVudERhdGFBcnJheSA9IFtdO1xuLy8gICAgIGN1cnJlbnRBcnJheS5wdXNoKGN1cnJlbnRUaW1lc2xvdFsnb2NjdXBhbmN5J10pO1xuLy8gICAgIGN1cnJlbnRBcnJheS5wdXNoKGN1cnJlbnRUaW1lc2xvdFsnbm9pc2UnXSk7XG4vLyAgICAgY3VycmVudEFycmF5LnB1c2goY3VycmVudFRpbWVzbG90WydodW1pZGl0eSddKTtcblxuLy8gICAgIHJldHVybiBjYWxjdWxhdGVDb2xvdXIoY3VycmVudEFycmF5LCBtYXhUb2xlcmFibGUsIG1pblRvbGVyYWJsZSk7XG4vLyB9XG5cbmZ1bmN0aW9uIGdldEN1cnJlbnRUaW1lc2xvdChpZCl7XG4gICAgdmFyIHN0b3JlO1xuICAgIGZvciggdmFyIGkgPSAwOyBpIDwgZ3JvdW5kRmxvb3Iuc3RvcmVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGlmIChzdG9yZURhdGFbaV1bJ2lkJ10gPT0gaWQpIHtcbiAgICAgICAgICAgIHN0b3JlID0gaTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiBzdG9yZURhdGFbc3RvcmVdWydoaXN0b3J5J11bMF1bJ3RpbWVzJ11bMF07XG59XG5cbmZ1bmN0aW9uIGNoZWNrVmFsdWUodmFsdWUsIG1heCwgbWluKXtcbiAgICB2YXIgY29sb3VyTGV2ZWwgPSAwO1xuICAgIGlmKHBhcnNlRmxvYXQodmFsdWUpID4gbWF4KXsgY29sb3VyTGV2ZWwgPSA1OyB9O1xuICAgIGlmKHBhcnNlRmxvYXQodmFsdWUpIDwgbWluKXsgY29sb3VyTGV2ZWwgPSAxOyB9O1xuICAgIGlmKHBhcnNlRmxvYXQodmFsdWUpIDwgbWF4ICYmIHBhcnNlRmxvYXQodmFsdWUgPiBtaW4pKXsgY29sb3VyTGV2ZWwgPSAzOyB9O1xuICAgIHJldHVybiBwYXJzZUludChjb2xvdXJMZXZlbCk7XG59XG5cbmZ1bmN0aW9uIGNhbGN1bGF0ZUNvbG91cihjdXJyZW50RGF0YU9iaiwgbWF4LCBtaW4pe1xuICAgIHZhciBjb2xvdXJMZXZlbCA9IDA7XG4gICAgdmFyIGNvbG91cjtcbiAgICB2YXIgb2NjdXBhbmN5ID0gY3VycmVudERhdGFPYmoub2NjdXBhbmN5O1xuICAgIHZhciBub2lzZSA9IGN1cnJlbnREYXRhT2JqLm5vaXNlO1xuICAgIHZhciBodW1pZGl0eSA9IGN1cnJlbnREYXRhT2JqLmh1bWlkaXR5O1xuXG4gICAgY29sb3VyTGV2ZWwgKz0gY2hlY2tWYWx1ZShvY2N1cGFuY3ksbWF4LG1pbik7XG4gICAgY29sb3VyTGV2ZWwgKz0gY2hlY2tWYWx1ZShub2lzZSwgbWF4LCBtaW4pO1xuICAgIGNvbG91ckxldmVsICs9IGNoZWNrVmFsdWUoaHVtaWRpdHksIG1heCwgbWluKTtcbiAgICBcbiAgICB2YXIgYXZnQ29sb3VyTGV2ZWwgPSBNYXRoLnJvdW5kKGNvbG91ckxldmVsIC8gMyk7XG4gICAgY29uc29sZS5sb2coYXZnQ29sb3VyTGV2ZWwpO1xuICAgIHN3aXRjaChhdmdDb2xvdXJMZXZlbCl7XG4gICAgICAgIGNhc2UgMTpcbiAgICAgICAgY2FzZSAyOlxuICAgICAgICAgICAgY29sb3VyID0gWzI1NSwwLDAsMjAwXTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIDM6XG4gICAgICAgICAgICBjb2xvdXIgPSBbMjU1LDE0MCwwLDIwMF07XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSA0OlxuICAgICAgICBjYXNlIDU6XG4gICAgICAgICAgICBjb2xvdXIgPSBbMCwyNTUsMCwyMDBdO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgfVxuICAgIHJldHVybiBjb2xvdXI7XG59XG4iXX0=
